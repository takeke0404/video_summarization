version: "3"

services:
    get_video:
        build: ./get_video
        volumes:
            - ./get_video:/video
        command: bash -c "bash get_video.sh && bash get_comment.sh && bash change_permission.sh"
    get_clip_position:
        build: ./get_clip_position
        volumes:
            - ./get_video:/get_video:ro
            - ./get_clip_position:/get_clip_position
        command: bash -c "bash get_clip_position_multiple.sh && bash change_permission.sh"
    analyze_comment:
        build: ./analyze_comment
        volumes:
            - ./analyze_comment:/analyze_comment
            - ./get_video:/get_video
            - ./get_clip_position:/get_clip_position
        command: bash -c "bash plot_comment.sh && bash get_clip_comment.sh && bash change_permission.sh"
    speech_segmentation:
        build: ./speech_segmentation
        volumes:
            - ./speech_segmentation:/speech_segmentation
            - ./get_video:/get_video
            - ./get_clip_position:/get_clip_position
        command: bash -c "bash speech_segmentation.sh"
    summarization_by_comment_count:
        build: ./summarization_by_comment_count
        volumes:
            - ./summarization_by_comment_count:/summarization_by_comment_count
            - ./speech_segmentation:/speech_segmentation
            - ./get_video:/get_video
            - ./get_clip_position:/get_clip_position
        command: bash -c "bash summarization_by_comment_count.sh"
    web:
        build: ./web
        ports:
          - 32768:80
        volumes:
          - ./web:/web
        tty: true
        environment:
          TZ: Asia/Tokyo
        command: python3 app.py
